<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://artcodelcy.github.io/</id>
    <title>æˆ˜</title>
    <updated>2019-08-28T13:47:59.742Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://artcodelcy.github.io/"/>
    <link rel="self" href="https://artcodelcy.github.io//atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://artcodelcy.github.io//images/avatar.png</logo>
    <icon>https://artcodelcy.github.io//favicon.ico</icon>
    <rights>All rights reserved 2019, æˆ˜</rights>
    <entry>
        <title type="html"><![CDATA[è°ˆè°ˆç¼“å­˜]]></title>
        <id>https://artcodelcy.github.io//post/tan-tan-huan-cun</id>
        <link href="https://artcodelcy.github.io//post/tan-tan-huan-cun">
        </link>
        <updated>2019-08-28T13:40:18.000Z</updated>
        <content type="html"><![CDATA[<h3 id="èŠèŠç¼“å­˜">èŠèŠç¼“å­˜ï¼š</h3>
<ul>
<li>ç¼“å­˜æœ€ç»ˆçš„ç›®çš„æ˜¯ä¸ºå‡è½»æœåŠ¡ç«¯å‹åŠ›ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“è¯·æ±‚<br>
æ¯”å¦‚ï¼š<br>
æµè§ˆå™¨è®¿é—®è‡ªå¸¦ç¼“å­˜ã€‚<br>
Appå®¢æˆ·ç«¯åº•å±‚éƒ½æœ‰ç¼“å­˜æŠ€æœ¯çš„ã€‚<br>
<strong>æ³¨ï¼š</strong><br>
ï¼ˆç§»åŠ¨ç«¯ç™»å½• ç”¨token æœ¬åœ°æ˜¯æœ‰ä¸ªæ–‡ä»¶çš„ï¼‰</li>
</ul>
<p><strong>æ¡ˆä¾‹ï¼š</strong></p>
<p>å¦‚æœä¸€æ—¦è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯ä¹‹åï¼Œä¼šåœ¨æœ¬åœ°ç¼“å­˜ä¸€ä»½ï¼Œå¿«é€Ÿå“åº”ç»™ç”¨æˆ·ã€‚</p>
<p><strong>å¸¸è§çš„ç¼“å­˜æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>ç½‘ç»œç¼“å­˜</li>
<li>ä»£ç†ç¼“å­˜ï¼ˆNginxå¯ä»¥ç¼“å­˜ï¼‰</li>
<li>CDNç¼“å­˜</li>
<li>æœåŠ¡å™¨ç¼“å­˜</li>
<li>æ•°æ®åº“ç¼“å­˜</li>
<li>å¹³å°ç¼“å­˜çº§ç¼“å­˜</li>
</ul>
<p><strong>æ€»ç»“ï¼š</strong> ç¼“å­˜æœ€ç»ˆçš„ç›®çš„æ˜¯ä¸ºå‡è½»æœåŠ¡ç«¯å‹åŠ›ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“è¯·æ±‚</p>
<h4 id="å•æœºç¼“å­˜ä¸åˆ†å¸ƒå¼ç¼“å­˜">å•æœºç¼“å­˜ä¸åˆ†å¸ƒå¼ç¼“å­˜ï¼š</h4>
<ul>
<li>
<p>Session æ˜¯å­˜æ”¾åœ¨æœåŠ¡å™¨ç«¯ï¼ˆä¿å­˜åœ¨å•ä¸ªJVMä¸­ï¼‰ï¼Œè¿”å›SessionIdï¼ˆå“åº”å¤´ï¼‰ï¼Œå®¢æˆ·ç«¯å­˜æ”¾çš„SessionIdï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶å€™ï¼Œç›´æ¥ä½¿ç”¨å¯¹äºçš„SessionIdä»æœåŠ¡å™¨ç«¯æŸ¥è¯¢å¯¹åº”Session</p>
</li>
<li>
<p>åˆ†å¸ƒå¼Session ï¼ˆSessionå…±äº«çš„é—®é¢˜ï¼‰----ç›´æ¥ä½¿ç”¨tokenè§£å†³</p>
</li>
</ul>
<hr>
<p><strong>æ¡ˆä¾‹å•æœºç‰ˆï¼š</strong><br>
å®ç°å•ä¸ªJVMç¼“å­˜æ¡†æ¶ï¼Œ Session Key Value  å¯ä»¥ç”¨Mapé›†åˆå®ç°  è¿‡æœŸæ—¶é—´éœ€è¦å¥½å¥½è®¾è®¡äº†<br>
å†™ä¸€ä¸ªç»™äºˆMapé›†åˆå®ç°Jvmç¼“å­˜æ¡†æ¶ï¼š</p>
<p>é¦–å…ˆå®šä¹‰mapå®ç°çš„ç¼“å­˜ç±»ï¼šï¼ˆconcurrentHashmapä¿è¯å®‰å…¨ï¼‰</p>
<p><strong>ç¼“å­˜ï¼š</strong></p>
<pre><code>@Component  //è¿™æ ·çš„è¯ å°±æ˜¯å•ä¾‹çš„äº†ï¼ï¼ï¼æ³¨å…¥åˆ°å®¹å™¨é‡Œé¢ 
public class MapCache&lt;K,V&gt; {
    //å­˜æ”¾ç¼“å­˜å®¹å™¨
   public ConcurrentHashMap&lt;K, V&gt; concurrentHashMap = new ConcurrentHashMap&lt;K,V&gt;();
    //çº¯æ‰‹å†™å•ä¸ªJVMç¼“å­˜æ¡†æ¶ ç¼“å­˜æ¦‚å¿µåå‘äºä¸´æ—¶
    
   //å¯¹ä¼ ç»Ÿçš„MapåŒ…è£…
   public void put(K key,V value){
       concurrentHashMap.put(key, value);
   }
   //æŸ¥è¯¢
   public V get(K key){
       return concurrentHashMap.get(key);
   }
   
   public void remove(String k){
       //è¿™ä¸ªmapæ˜¯å®‰å…¨çš„ ä¸éœ€è¦åŠ é”ï¼
       concurrentHashMap.remove(k);
   }
}
</code></pre>
<p><strong>controllerç±»ï¼š</strong></p>
<pre><code>@RestController
public class IndexController {
  
    @Autowired
    private MapCache&lt;String, Object&gt; mapCache;
    
    @RequestMapping(&quot;/get&quot;)
    public String get(String key){
        return (String)mapCache.get(key);
    }
    
    @RequestMapping(&quot;/put&quot;)
    public String put(String key, String value){
        mapCache.put(key, value);
        return &quot;æˆåŠŸ&quot;;
    }
    
    @RequestMapping(&quot;/remove&quot;)
    public String remove(String key){
        mapCache.remove(key);
        return &quot;æˆåŠŸ&quot;;
    }

}
</code></pre>
<p><strong>Appå¯åŠ¨ç±»</strong></p>
<pre><code>@SpringBootApplication(scanBasePackages={&quot;com.toov5.*&quot;})
public class app {
   public static void main(String[] args) {
    SpringApplication.run(app.class, args);
}
    
}
</code></pre>
<hr>
<h3 id="å•æœºç‰ˆç¼“å­˜æ¡†æ¶">å•æœºç‰ˆç¼“å­˜æ¡†æ¶</h3>
<ul>
<li>
<p>å•ç‚¹ç¼“å­˜æ¡†æ¶   åªèƒ½é’ˆå¯¹å•ä¸ªjvmä¸­ï¼Œç¼“å­˜å®¹å™¨å­˜æ”¾jvmä¸­ï¼Œæ¯ä¸ªç¼“å­˜äº’ä¸å½±å“  Ehcache gauva chache å†…ç½®ç¼“å­˜æ¡†æ¶ jvmç¼“å­˜æ¡†æ¶</p>
</li>
<li>
<p>åˆ†å¸ƒå¼ç¼“å­˜æŠ€æœ¯ï¼ˆå…±äº«ç¼“å­˜æ•°æ®ï¼‰  Redis Meacache</p>
</li>
</ul>
<p><strong>exampleï¼š</strong></p>
<p>mybatisã€hibernateåº•å±‚éƒ½ä½¿ç”¨äº†Ehcache</p>
<p>æœ¬åœ°ç¼“å­˜Ehcache<br>
ä»€ä¹ˆæ˜¯Ehcache<br>
â€ƒEhcacheæ˜¯çº¯javaçš„å¼€æºç¼“å­˜æ¡†æ¶ï¼Œå…·æœ‰å¿«é€Ÿã€ç²¾å¹²ç­‰ç‰¹ç‚¹ï¼Œæ˜¯Hibernateä¸­é»˜è®¤çš„CacheProviderã€‚å®ƒä¸»è¦é¢å‘é€šç”¨ç¼“å­˜ã€Java EEå’Œè½»é‡çº§å®¹å™¨ï¼Œå…·æœ‰å†…å­˜å’Œç£ç›˜å­˜å‚¨ã€ç¼“å­˜åŠ è½½å™¨ã€ç¼“å­˜æ‰©å±•ã€ç¼“å­˜å¼‚å¸¸å¤„ç†ç¨‹åºã€‚</p>
<p>Ehcacheæœ€åˆç”±Greg Luckäº2003å¹´å¼€å§‹å¼€å‘ã€‚2009å¹´,è¯¥é¡¹ç›®è¢«Terracottaè´­ä¹°ã€‚è½¯ä»¶ä»ç„¶å¼€æº,ä½†ä¸€äº›æ–°çš„ä¸»è¦åŠŸèƒ½(ä¾‹å¦‚ï¼Œå¿«é€Ÿå¯é‡å¯æ€§ä¹‹é—´çš„ä¸€è‡´æ€§çš„)åªèƒ½åœ¨å•†ä¸šäº§å“ä¸­ä½¿ç”¨ã€‚</p>
<p>Ehcache è¢«å¹¿æ³›ç”¨äºåœ¨Hibernateã€Springã€Cocoonç­‰å…¶ä»–å¼€æºç³»ç»Ÿã€‚</p>
<p>Ehcacheçš„ä¸»è¦ç‰¹æ€§<br>
1.å¿«é€Ÿï¼›</p>
<p>2.ç®€å•ï¼›</p>
<p>3.å¤šç§ç¼“å­˜ç­–ç•¥ï¼›</p>
<p>4.ç¼“å­˜æ•°æ®æœ‰ä¸¤çº§ï¼šå†…å­˜å’Œç£ç›˜ï¼Œå› æ­¤æ— éœ€æ‹…å¿ƒå®¹é‡é—®é¢˜ï¼›</p>
<p>5.ç¼“å­˜æ•°æ®ä¼šåœ¨è™šæ‹Ÿæœºé‡å¯çš„è¿‡ç¨‹ä¸­å†™å…¥ç£ç›˜ï¼›</p>
<p>6.å¯ä»¥é€šè¿‡ RMIã€å¯æ’å…¥ API ç­‰æ–¹å¼è¿›è¡Œåˆ†å¸ƒå¼ç¼“å­˜ï¼›</p>
<p>7.å…·æœ‰ç¼“å­˜å’Œç¼“å­˜ç®¡ç†å™¨çš„ä¾¦å¬æ¥å£ï¼›ï¼ˆä¸ºäº†åšé›†ç¾¤ï¼‰</p>
<p>8.æ”¯æŒå¤šç¼“å­˜ç®¡ç†å™¨å®ä¾‹ï¼Œä»¥åŠä¸€ä¸ªå®ä¾‹çš„å¤šä¸ªç¼“å­˜åŒºåŸŸï¼›</p>
<p>9.æä¾› Hibernate çš„ç¼“å­˜å®ç°ï¼›</p>
<h2 id="ehcacheä½¿ç”¨ä»‹ç»">Ehcacheä½¿ç”¨ä»‹ç»</h2>
<p>Ehcacheæ˜¯ç”¨æ¥ç®¡ç†ç¼“å­˜çš„ä¸€ä¸ªå·¥å…·ï¼Œå…¶ç¼“å­˜çš„æ•°æ®å¯ä»¥æ˜¯å­˜æ”¾åœ¨å†…å­˜é‡Œé¢çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å­˜æ”¾åœ¨ç¡¬ç›˜ä¸Šçš„ã€‚å…¶æ ¸å¿ƒæ˜¯CacheManagerï¼Œä¸€åˆ‡Ehcacheçš„åº”ç”¨éƒ½æ˜¯ä»CacheManagerå¼€å§‹çš„ã€‚å®ƒæ˜¯ç”¨æ¥ç®¡ç†Cacheï¼ˆç¼“å­˜ï¼‰çš„ï¼Œä¸€ä¸ªåº”ç”¨å¯ä»¥æœ‰å¤šä¸ªCacheManagerï¼Œè€Œä¸€ä¸ªCacheManagerä¸‹åˆå¯ä»¥æœ‰å¤šä¸ªCacheã€‚Cacheå†…éƒ¨ä¿å­˜çš„æ˜¯ä¸€ä¸ªä¸ªçš„Elementï¼Œè€Œä¸€ä¸ªElementä¸­ä¿å­˜çš„æ˜¯ä¸€ä¸ªkeyå’Œvalueçš„é…å¯¹ï¼Œç›¸å½“äºMapé‡Œé¢çš„ä¸€ä¸ªEntryã€‚</p>
<ul>
<li>
<p>Ehcacheç¼“å­˜è¿‡æœŸç­–ç•¥<br>
(æ“ä½œç³»ç»Ÿé‡Œé¢å°±æœ‰å‘€~)</p>
</li>
<li>
<p>å½“ç¼“å­˜éœ€è¦è¢«æ¸…ç†æ—¶ï¼ˆæ¯”å¦‚ç©ºé—´å ç”¨å·²ç»æ¥è¿‘ä¸´ç•Œå€¼äº†ï¼‰ï¼Œéœ€è¦ä½¿ç”¨æŸç§æ·˜æ±°ç®—æ³•æ¥å†³å®šæ¸…ç†æ‰å“ªäº›æ•°æ®ã€‚å¸¸ç”¨çš„æ·˜æ±°ç®—æ³•æœ‰ä¸‹é¢å‡ ç§ï¼š</p>
</li>
</ul>
<p><strong>FIFO</strong>ï¼šFirst In First Outï¼Œå…ˆè¿›å…ˆå‡ºã€‚åˆ¤æ–­è¢«å­˜å‚¨çš„æ—¶é—´ï¼Œç¦»ç›®å‰æœ€è¿œçš„æ•°æ®ä¼˜å…ˆè¢«æ·˜æ±°ã€‚</p>
<p><strong>LRU</strong>ï¼šLeast Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ã€‚åˆ¤æ–­æœ€è¿‘è¢«ä½¿ç”¨çš„æ—¶é—´ï¼Œç›®å‰æœ€è¿œçš„æ•°æ®ä¼˜å…ˆè¢«æ·˜æ±°ã€‚ï¼ˆé»˜è®¤ï¼‰</p>
<p><strong>LFU</strong>ï¼šLeast Frequently Usedï¼Œæœ€ä¸ç»å¸¸ä½¿ç”¨ã€‚åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œæ•°æ®è¢«ä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„ï¼Œä¼˜å…ˆè¢«æ·˜æ±°ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li>ç¼“å­˜æ˜¯å®¹å™¨å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œä¸ºäº†ä¿è¯æŒä¹…åŒ–æœºåˆ¶ï¼Œå°†ç¼“å­˜ä¸­çš„å€¼æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸Šï¼ˆæ—¥å¿—ç¼“å­˜æ–‡ä»¶æ ¼å¼ï¼‰ã€‚å¦åˆ™æœåŠ¡å™¨é‡å¯ å°±æ²¡äº†å“¦ï¼</li>
<li>ç¼“å­˜æ¡†æ¶éƒ½æ˜¯æ”¯æŒå¯¹å†…å­˜å’Œç¡¬ç›˜æ”¯æŒ</li>
<li>JVMå†…ç½®ç¼“å­˜å®ç° ï¼ˆä¸ºäº†å‡è½»æ•°æ®åº“è®¿é—®å‹åŠ›ï¼‰</li>
<li>å†…å­˜åƒä¸æ„é”€ï¼Œé™åˆ¶è€Œå®¹é‡å¤§å°ï¼Œä¼šæœ‰ç›¸åº”çš„ç®—æ³•å¤„ç†æœºåˆ¶ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/artcodelcy/imgs/master/imgs-blog20190828141218.png" alt=""></p>
<p><strong>Spring Boot æ•´åˆEhCache:</strong><br>
pom:</p>
<pre><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.toov5.architect&lt;/groupId&gt;
  &lt;artifactId&gt;architect&lt;/artifactId&gt;
  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
  &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.0.0.RELEASE&lt;/version&gt;
    &lt;/parent&gt;
    &lt;dependencies&gt;
        &lt;!-- SpringBoot å¯¹lombok æ”¯æŒ --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- SpringBoot web æ ¸å¿ƒç»„ä»¶ --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- SpringBoot å¤–éƒ¨tomcatæ”¯æŒ --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;
            &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- springboot-log4j --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-log4j&lt;/artifactId&gt;
            &lt;version&gt;1.3.8.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- springboot-aop æŠ€æœ¯ --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- https://mvnrepository.com/artifact/commons-lang/commons-lang --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;commons-lang&lt;/groupId&gt;
            &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;
            &lt;version&gt;2.6&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.apache.httpcomponents/httpclient --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;
            &lt;artifactId&gt;httpclient&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;
            &lt;version&gt;1.2.47&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;jstl&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;taglibs&lt;/groupId&gt;
            &lt;artifactId&gt;standard&lt;/artifactId&gt;
            &lt;version&gt;1.1.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--å¼€å¯ cache ç¼“å­˜ --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- ehcacheç¼“å­˜ --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;net.sf.ehcache&lt;/groupId&gt;
            &lt;artifactId&gt;ehcache&lt;/artifactId&gt;
            &lt;version&gt;2.9.1&lt;/version&gt;&lt;!--$NO-MVN-MAN-VER$ --&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;1.1.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- mysql ä¾èµ– --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
  
&lt;/project&gt;
</code></pre>
<p>å®ä½“ç±»ï¼š</p>
<pre><code>package com.toov5.entity;

import lombok.Data;

@Data
public class Users {
  private String name;
  private Integer age;
}
</code></pre>
<p>controller</p>
<pre><code>package com.toov5.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.toov5.entity.Users;
import com.toov5.service.UserService;

@RestController
public class IndexController {
      
    @Autowired
    private UserService userService;
    
    @RequestMapping(&quot;/getUser&quot;)
    public List&lt;Users&gt; getUser(Long id){
        return userService.getUser(id);
    }

}
</code></pre>
<p>service:</p>
<pre><code>package com.toov5.service;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.toov5.entity.Users;
import com.toov5.mapper.UserMapper;

@Service
public class UserService {
    @Autowired
    private UserMapper userMapper;
    
   public List&lt;Users&gt; getUser(Long id){
       return userMapper.getUser(id);
   }
}
</code></pre>
<p>mapper:</p>
<pre><code>package com.toov5.mapper;

import java.util.List;

import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Select;
import org.springframework.cache.annotation.CacheConfig;
import org.springframework.cache.annotation.Cacheable;

import com.toov5.entity.Users;
//å¼•å…¥çš„jaråŒ…åå°±æœ‰äº†è¿™ä¸ªæ³¨è§£äº† éå¸¸å¥½ç”¨ ï¼ˆé…ç½®ç¼“å­˜çš„åŸºæœ¬ä¿¡æ¯ï¼‰
@CacheConfig(cacheNames={&quot;userCache&quot;})  //ç¼“å­˜çš„åå­—  æ•´ä¸ªç±»çš„
public interface UserMapper {
    @Select(&quot;SELECT ID ,NAME,AGE FROM users where id=#{id}&quot;)
    @Cacheable //è®©è¿™ä¸ªæ–¹æ³•å®ç°ç¼“å­˜ æŸ¥è¯¢å®Œæ¯•å å­˜å…¥åˆ°ç¼“å­˜ä¸­  ä¸æ˜¯æ¯ä¸ªæ–¹æ³•éƒ½éœ€è¦ç¼“å­˜å‘€ï¼save()å°±ä¸ç”¨äº†å§
    List&lt;Users&gt; getUser(@Param(&quot;id&quot;) Long id);
}
</code></pre>
<p>EhCacheé…ç½®ï¼š</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;ehcache xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:noNamespaceSchemaLocation=&quot;http://ehcache.org/ehcache.xsd&quot;&gt;
 
    &lt;diskStore path=&quot;java.io.tmpdir/ehcache-rmi-4000&quot; /&gt;
 
 
    &lt;!-- é»˜è®¤ç¼“å­˜ --&gt;
    &lt;defaultCache maxElementsInMemory=&quot;1000&quot; eternal=&quot;true&quot;
        timeToIdleSeconds=&quot;120&quot; timeToLiveSeconds=&quot;120&quot; overflowToDisk=&quot;true&quot;
        diskSpoolBufferSizeMB=&quot;30&quot; maxElementsOnDisk=&quot;10000000&quot;
        diskPersistent=&quot;true&quot; diskExpiryThreadIntervalSeconds=&quot;120&quot;
        memoryStoreEvictionPolicy=&quot;LRU&quot;&gt;
    &lt;/defaultCache&gt;
   
    &lt;!-- demoç¼“å­˜ --&gt;&lt;!-- name=&quot;userCache&quot; å¯¹åº”æˆ‘ä»¬åœ¨ @CacheConfig(cacheNames={&quot;userCache&quot;}) ï¼ï¼ï¼ï¼ï¼ --&gt;
    &lt;!--Ehcacheåº•å±‚ä¹Ÿæ˜¯ç”¨Mapé›†åˆå®ç°çš„ --&gt;
    &lt;cache name=&quot;userCache&quot; maxElementsInMemory=&quot;1000&quot; eternal=&quot;false&quot;
        timeToIdleSeconds=&quot;120&quot; timeToLiveSeconds=&quot;120&quot; overflowToDisk=&quot;true&quot;
        diskSpoolBufferSizeMB=&quot;30&quot; maxElementsOnDisk=&quot;10000000&quot;
        diskPersistent=&quot;false&quot; diskExpiryThreadIntervalSeconds=&quot;120&quot;
        memoryStoreEvictionPolicy=&quot;LRU&quot;&gt;  &lt;!-- LRUç¼“å­˜ç­–ç•¥ --&gt;
        &lt;cacheEventListenerFactory
            class=&quot;net.sf.ehcache.distribution.RMICacheReplicatorFactory&quot; /&gt;
        &lt;!-- ç”¨äºåœ¨åˆå§‹åŒ–ç¼“å­˜ï¼Œä»¥åŠè‡ªåŠ¨è®¾ç½® --&gt;
        &lt;bootstrapCacheLoaderFactory
            class=&quot;net.sf.ehcache.distribution.RMIBootstrapCacheLoaderFactory&quot; /&gt;
    &lt;/cache&gt;
&lt;/ehcache&gt;

</code></pre>
<p>Spring booté…ç½®ï¼š</p>
<pre><code>###ç«¯å£å·é…ç½®
server:
  port: 8080
###æ•°æ®åº“é…ç½® 
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/test
    username: root
    password: root
    driver-class-name: com.mysql.jdbc.Driver
    test-while-idle: true
    test-on-borrow: true
    validation-query: SELECT 1 FROM DUAL
    time-between-eviction-runs-millis: 300000
    min-evictable-idle-time-millis: 1800000
# ç¼“å­˜é…ç½®è¯»å–
  cache:
    type: ehcache
    ehcache:
      config: classpath:app1_ehcache.xml 
</code></pre>
<p>å¯åŠ¨ï¼š</p>
<pre><code>package com.toov5.app;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cache.annotation.EnableCaching;

@EnableCaching //å¼€å¯ç¼“å­˜
@MapperScan(basePackages={&quot;com.toov5.mapper&quot;})
@SpringBootApplication(scanBasePackages={&quot;com.toov5.*&quot;})
public class app {
   public static void main(String[] args) {
    SpringApplication.run(app.class, args);
}
    
}
</code></pre>
<p>é¡¹ç›®ç»“æ„:</p>
<p><img src="https://cdn.jsdelivr.net/gh/artcodelcy/imgs/imgs-blog20190828191109.png" alt=""></p>
<p>è®¿é—®:</p>
<p><img src="https://cdn.jsdelivr.net/gh/artcodelcy/imgs/imgs-blog20190828191218.png" alt=""></p>
<p><strong>å¤‡æ³¨:ã€EhCacheå‚æ•°ç›¸å…³ã€‘</strong></p>
<pre><code>1. diskStore ï¼šæŒ‡å®šæ•°æ®(.data and .index)å­˜å‚¨ä½ç½®ï¼Œå¯æŒ‡å®šç£ç›˜ä¸­çš„æ–‡ä»¶å¤¹ä½ç½®æœŸ The diskStore element is optional. It must be configured if you have overflowToDisk or diskPersistent enabled    for any cache. If it is not configured, a warning will be issues and java.io.tmpdir will be used.
2. defaultCache ï¼š é»˜è®¤çš„ç®¡ç†ç­–ç•¥
Ehcache ä½¿ç”¨Mapé›†åˆå®ç°çš„ element å…¶å®å°±æ˜¯ key å’Œvalue

ä¸€ã€ä»¥ä¸‹å±æ€§æ˜¯å¿…é¡»çš„ï¼š

ã€€ã€€1ã€nameï¼š Cacheçš„åç§°ï¼Œå¿…é¡»æ˜¯å”¯ä¸€çš„(ehcacheä¼šæŠŠè¿™ä¸ªcacheæ”¾åˆ°HashMapé‡Œ)ã€‚

ã€€ã€€2ã€maxElementsInMemoryï¼šåœ¨å†…å­˜ä¸­ç¼“å­˜çš„elementçš„æœ€å¤§æ•°ç›®ã€‚

ã€€ã€€3ã€maxElementsOnDiskï¼šåœ¨ç£ç›˜ä¸Šç¼“å­˜çš„elementçš„æœ€å¤§æ•°ç›®ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸é™åˆ¶ã€‚

ã€€ã€€ï¼”ã€eternalï¼šè®¾å®šç¼“å­˜çš„elementsæ˜¯å¦æ°¸è¿œä¸è¿‡æœŸã€‚å¦‚æœä¸ºtrueï¼Œåˆ™ç¼“å­˜çš„æ•°æ®å§‹ç»ˆæœ‰æ•ˆï¼Œå¦‚æœä¸ºfalseé‚£ä¹ˆè¿˜è¦æ ¹æ®timeToIdleSecondsï¼ŒtimeToLiveSecondsåˆ¤æ–­ã€‚

ã€€ã€€ï¼•ã€overflowToDiskï¼š å¦‚æœå†…å­˜ä¸­æ•°æ®è¶…è¿‡å†…å­˜é™åˆ¶ï¼Œæ˜¯å¦è¦ç¼“å­˜åˆ°ç£ç›˜ä¸Šã€‚

äºŒã€ä»¥ä¸‹å±æ€§æ˜¯å¯é€‰çš„ï¼š

ã€€ã€€ï¼‘ã€timeToIdleSecondsï¼š å¯¹è±¡ç©ºé—²æ—¶é—´ï¼ŒæŒ‡å¯¹è±¡åœ¨å¤šé•¿æ—¶é—´æ²¡æœ‰è¢«è®¿é—®å°±ä¼šå¤±æ•ˆã€‚åªå¯¹eternalä¸ºfalseçš„æœ‰æ•ˆã€‚é»˜è®¤å€¼0ï¼Œè¡¨ç¤ºä¸€ç›´å¯ä»¥è®¿é—®ã€‚

ã€€ã€€ï¼’ã€timeToLiveSecondsï¼š å¯¹è±¡å­˜æ´»æ—¶é—´ï¼ŒæŒ‡å¯¹è±¡ä»åˆ›å»ºåˆ°å¤±æ•ˆæ‰€éœ€è¦çš„æ—¶é—´ã€‚åªå¯¹eternalä¸ºfalseçš„æœ‰æ•ˆã€‚é»˜è®¤å€¼0ï¼Œè¡¨ç¤ºä¸€ç›´å¯ä»¥è®¿é—®ã€‚

ã€€ã€€ï¼“ã€diskPersistentï¼š æ˜¯å¦åœ¨ç£ç›˜ä¸ŠæŒä¹…åŒ–ã€‚æŒ‡é‡å¯jvmåï¼Œæ•°æ®æ˜¯å¦æœ‰æ•ˆã€‚é»˜è®¤ä¸ºfalseã€‚

ã€€ã€€ï¼”ã€diskExpiryThreadIntervalSecondsï¼š å¯¹è±¡æ£€æµ‹çº¿ç¨‹è¿è¡Œæ—¶é—´é—´éš”ã€‚æ ‡è¯†å¯¹è±¡çŠ¶æ€çš„çº¿ç¨‹å¤šé•¿æ—¶é—´è¿è¡Œä¸€æ¬¡ã€‚

ã€€ã€€ï¼•ã€diskSpoolBufferSizeMBï¼š DiskStoreä½¿ç”¨çš„ç£ç›˜å¤§å°ï¼Œé»˜è®¤å€¼30MBã€‚æ¯ä¸ªcacheä½¿ç”¨å„è‡ªçš„DiskStoreã€‚

ã€€ã€€ï¼–ã€memoryStoreEvictionPolicyï¼š å¦‚æœå†…å­˜ä¸­æ•°æ®è¶…è¿‡å†…å­˜é™åˆ¶ï¼Œå‘ç£ç›˜ç¼“å­˜æ—¶çš„ç­–ç•¥ã€‚é»˜è®¤å€¼LRUï¼Œå¯é€‰FIFOã€LFUã€‚
</code></pre>
<p>EhCacheåŒæ­¥DB:<br>
åœºæ™¯æè¿°ï¼š</p>
<pre><code>update æˆ–è€…delete å®¹æ˜“é€ æˆç¼“å­˜å’ŒDBä¸åŒæ­¥é—®é¢˜   
</code></pre>
<p>è§£å†³æ–¹æ¡ˆ:</p>
<ul>
<li>ä¸»åŠ¨é€šçŸ¥æˆ–è€…å®šæ—¶Job</li>
<li>updateè¯­å¥å,åŠ ä¸Šé€šçŸ¥,è¿›è¡Œä¸»åŠ¨é€šçŸ¥</li>
<li>å…ˆä¿®æ”¹æˆåŠŸ ç„¶åæ¸…ç†ç¼“å­˜ã€‚ã€éƒ½æ˜¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„ã€‘</li>
<li>å®šæ—¶Jobå¥åº·æ£€æŸ¥ï¼Œæ£€æŸ¥DBå’Œç¼“å­˜æ˜¯å¦ä¸€è‡´ã€‚ç„¶åå†³å®šæ‰§è¡Œæ¸…ç†ç¼“å­˜</li>
</ul>
<p>ä»£ç å®ç°ï¼š</p>
<ul>
<li>controllerã€åŠ å…¥æ¸…ç¼“å­˜çš„é€»è¾‘ã€‘</li>
</ul>
<pre><code>package com.toov5.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.cache.CacheManager;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.toov5.entity.Users;
import com.toov5.service.UserService;

@RestController
public class IndexController {
    @Autowired
    private CacheManager cacheManager;
    @Autowired
    private UserService userService;
    //æ³¨æ„å¼•å…¥çš„jaråŒ…æ˜¯ org.springframework.cache.CacheManager;
    @RequestMapping(&quot;/remoKey&quot;)
    public void remoKey() {
        cacheManager.getCache(&quot;userCache&quot;).clear();  //ä¼ å…¥åå­— è¿›è¡Œæ¸…é™¤
    }
    
    @RequestMapping(&quot;/getUser&quot;)
    public List&lt;Users&gt; getUser(Long id){
        return userService.getUser(id);
    }

}
</code></pre>
<p>1.è®¿é—®ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/artcodelcy/imgs/imgs-blog20190828193107.png" alt=""></p>
<p>2.ä¿®æ”¹æ•°æ®</p>
<p>3.æ‰‹åŠ¨æ¸…ç†ç¼“å­˜ï¼Œæ¥å£è°ƒç”¨</p>
<p><img src="https://cdn.jsdelivr.net/gh/artcodelcy/imgs/imgs-blog20190828193251.png" alt=""></p>
<p>4.è®¿é—®ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/artcodelcy/imgs/imgs-blog20190828193345.png" alt=""></p>
<ol start="5">
<li>å¤§åŠŸå‘Šæˆï¼</li>
</ol>
<hr>
<h1 id="åˆ†å¸ƒå¼ç¼“å­˜">åˆ†å¸ƒå¼ç¼“å­˜</h1>
<h2 id="ehcacherediså®ç°åˆ†å¸ƒå¼ç¼“å­˜">EhCache+Rediså®ç°åˆ†å¸ƒå¼ç¼“å­˜</h2>
<h4 id="ehcacheé›†ç¾¤æ¨¡å¼ä»‹ç»">Ehcacheé›†ç¾¤æ¨¡å¼ä»‹ç»</h4>
<p>ç”±äº EhCache æ˜¯è¿›ç¨‹ä¸­çš„ç¼“å­˜ç³»ç»Ÿï¼Œä¸€æ—¦å°†åº”ç”¨éƒ¨ç½²åœ¨é›†ç¾¤ç¯å¢ƒä¸­ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ç»´æŠ¤å„è‡ªçš„ç¼“å­˜æ•°æ®ï¼Œå½“æŸä¸ªèŠ‚ç‚¹å¯¹ç¼“å­˜æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œè¿™äº›æ›´æ–°çš„æ•°æ®æ— æ³•åœ¨å…¶å®ƒèŠ‚ç‚¹ä¸­å…±äº«ï¼Œè¿™ä¸ä»…ä¼šé™ä½èŠ‚ç‚¹è¿è¡Œçš„æ•ˆç‡ï¼Œè€Œä¸”ä¼šå¯¼è‡´æ•°æ®ä¸åŒæ­¥çš„æƒ…å†µå‘ç”Ÿã€‚ä¾‹å¦‚æŸä¸ªç½‘ç«™é‡‡ç”¨ Aã€B ä¸¤ä¸ªèŠ‚ç‚¹ä½œä¸ºé›†ç¾¤éƒ¨ç½²ï¼Œå½“ A èŠ‚ç‚¹çš„ç¼“å­˜æ›´æ–°åï¼Œè€Œ B èŠ‚ç‚¹ç¼“å­˜å°šæœªæ›´æ–°å°±å¯èƒ½å‡ºç°ç”¨æˆ·åœ¨æµè§ˆé¡µé¢çš„æ—¶å€™ï¼Œä¸€ä¼šæ˜¯æ›´æ–°åçš„æ•°æ®ï¼Œä¸€ä¼šæ˜¯å°šæœªæ›´æ–°çš„æ•°æ®ï¼Œå°½ç®¡æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ Session Sticky æŠ€æœ¯æ¥å°†ç”¨æˆ·é”å®šåœ¨æŸä¸ªèŠ‚ç‚¹ä¸Šï¼Œä½†å¯¹äºä¸€äº›äº¤äº’æ€§æ¯”è¾ƒå¼ºæˆ–è€…æ˜¯é Web æ–¹å¼çš„ç³»ç»Ÿæ¥è¯´ï¼ŒSession Sticky æ˜¾ç„¶ä¸å¤ªé€‚åˆã€‚</p>
<h3 id="ehcacheå¸¸ç”¨é›†ç¾¤æ¨¡å¼">EhCacheå¸¸ç”¨é›†ç¾¤æ¨¡å¼</h3>
<p>EhCacheä»1.7ç‰ˆæœ¬å¼€å§‹ï¼Œæ”¯æŒäº”ç§é›†ç¾¤æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>Terracotta</li>
<li>RMI</li>
</ul>
<pre><code>RMié›†ç¾¤æ¨¡å¼
ä½ å¦‚ä½•çŸ¥é“é›†ç¾¤ç¯å¢ƒä¸­çš„å…¶ä»–ç¼“å­˜ï¼Ÿ

â€¢ åˆ†å¸ƒå¼ä¼ é€çš„æ¶ˆæ¯æ˜¯ä»€ä¹ˆå½¢å¼ï¼Ÿ

â€¢ ä»€ä¹ˆæƒ…å†µéœ€è¦è¿›è¡Œå¤åˆ¶ï¼Ÿå¢åŠ ï¼ˆPutsï¼‰ï¼Œæ›´æ–°ï¼ˆUpdatesï¼‰æˆ–æ˜¯å¤±æ•ˆï¼ˆExpiriesï¼‰ï¼Ÿ

â€¢ é‡‡ç”¨ä»€ä¹ˆæ–¹å¼è¿›è¡Œå¤åˆ¶ï¼ŸåŒæ­¥è¿˜æ˜¯å¼‚æ­¥æ–¹å¼ï¼Ÿ

 
1ã€æ­£ç¡®çš„å…ƒç´ ç±»å‹ï¼šåªæœ‰å¯åºåˆ—åŒ–çš„å…ƒç´ å¯ä»¥è¿›è¡Œå¤åˆ¶ã€‚ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚ç§»é™¤ï¼Œåªéœ€è¦å…ƒç´ çš„é”®å€¼è€Œä¸ç”¨æ•´ä¸ªå…ƒç´ ï¼›åœ¨è¿™æ ·çš„æ“ä½œä¸­å³ä½¿å…ƒç´ ä¸æ˜¯å¯åºåˆ—åŒ–çš„ä½†é”®å€¼æ˜¯å¯åºåˆ—åŒ–çš„ä¹Ÿå¯ä»¥è¢«å¤åˆ¶ã€‚

2ã€æˆå‘˜å‘ç°ï¼ˆPeer Discoveryï¼‰ï¼šEhcacheè¿›è¡Œé›†ç¾¤çš„æ—¶å€™æœ‰ä¸€ä¸ªcacheç»„çš„æ¦‚å¿µã€‚æ¯ä¸ªcacheéƒ½æ˜¯å…¶ä»–cacheçš„ä¸€ä¸ªpeerï¼Œæ²¡æœ‰ä¸»cacheçš„å­˜åœ¨ã€‚æˆå‘˜å‘ç°ï¼ˆPeer Discoveryï¼‰æ­£æ˜¯ç”¨æ¥è§£å†³ â€œä½ å¦‚ä½•çŸ¥é“é›†ç¾¤ç¯å¢ƒä¸­çš„å…¶ä»–ç¼“å­˜?â€ è¿™ä¸ªé—®é¢˜çš„ã€‚Ehcacheæä¾›äº†ä¸¤ç§æœºåˆ¶ç”¨æ¥è¿›è¡Œæˆå‘˜å‘ç°ï¼Œå³ï¼šè‡ªåŠ¨æˆå‘˜å‘ç°å’Œæ‰‹åŠ¨æˆå‘˜å‘ç°ã€‚è¦ä½¿ç”¨ä¸€ä¸ªå†…ç½®çš„æˆå‘˜å‘ç°æœºåˆ¶è¦åœ¨ehcacheçš„é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šcacheManagerPeerProviderFactoryå…ƒç´ çš„classå±æ€§ä¸º

net.sf.ehcache.distribution.RMICacheManagerPeerProviderFactoryã€‚
</code></pre>
<ul>
<li>JMS</li>
<li>JGroups</li>
<li>EhCache Server</li>
</ul>
<h3 id="ehcacheçš„ä½¿ç”¨åœºæ™¯">Ehcacheçš„ä½¿ç”¨åœºæ™¯</h3>
<ul>
<li>ä½¿ç”¨çº¯javaçš„ehcacheä½œä¸ºæœ¬åœ°ç¼“å­˜</li>
<li>Reids ä½œä¸ºè¿œç¨‹åˆ†å¸ƒå¼ç¼“å­˜</li>
<li>è§£å†³redisç¼“å­˜å‹åŠ›è¿‡å¤§ï¼Œæé«˜ç¼“å­˜é€Ÿåº¦ï¼Œä»¥åŠç¼“å­˜æ€§èƒ½ã€‚</li>
</ul>
<h3 id="rediså’Œehcacheç¼“å­˜çš„åŒºåˆ«">Rediså’ŒEhcacheç¼“å­˜çš„åŒºåˆ«</h3>
<ul>
<li>å¦‚æœæ˜¯å•ä¸ªåº”ç”¨æˆ–è€…å¯¹ç¼“å­˜è®¿é—®è¦æ±‚å¾ˆé«˜çš„åº”ç”¨ï¼Œç”¨EhCacheã€‚</li>
<li>å¦‚æœæ˜¯å¤§å‹ç³»ç»Ÿï¼Œå­˜åœ¨ç¼“å­˜å…±äº«ã€åˆ†å¸ƒå¼éƒ¨ç½²ã€ç¼“å­˜å†…å®¹å¾ˆå¤§çš„ï¼Œå»ºè®®ç”¨redisã€‚</li>
<li>EHCacheé€‚åˆå•ä½“é¡¹ç›®ç¼“å­˜ï¼Œä¸é€‚åˆäºåˆ†å¸ƒå¼ã€‚(ä¸æ”¯æŒå…±äº«),å› ä¸ºä»–ä»¬å­˜æ”¾åœ¨JVMä¸­ï¼Œäº’ä¸å½±å“ã€‚</li>
<li>åˆ†å¸ƒå¼ç¼“å­˜æ¶æ„ä¸­ï¼Œä½¿ç”¨Redis+EHCacheå®ç°åˆ†å¸ƒå¼ç¼“å­˜ã€‚åˆ†å¸ƒå¼ ä¸€çº§ã€äºŒçº§ç¼“å­˜ã€‚<br>
æ¯”å¦‚:<br>
å¦‚æœRedisé›†ç¾¤ å› ä¸º æŸäº›åŸå›  å…¨éƒ¨å®•æœº ã€‚ å®¢æˆ·ç«¯ä¼šä¸€ç›´æŸ¥è¯¢æ•°æ®åº“ï¼</li>
<li>Redisæ”¯æŒåˆ†å¸ƒå¼å…±äº«æŸ¥è¯¢</li>
</ul>
<p><strong>æ³¨:</strong><br>
EhCacheæ”¯æŒåˆ†å¸ƒå¼ç¼“å­˜ ä½†æ˜¯ä¸æ¨è</p>
<h2 id="ehcacheå®é™…ä½¿ç”¨åœºæ™¯æ€»ç»“">EhCacheå®é™…ä½¿ç”¨åœºæ™¯æ€»ç»“:</h2>
<ol>
<li>æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨é›†ä¸­å¼ç¼“å­˜(Redisæˆ–è€…å¼Memcachedç­‰)ï¼Œé€šå¸¸éƒ½æ˜¯æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨æœŸæœ›å€¼çš„æ•°æ®ï¼Œå¦‚æœå­˜åœ¨ç›´æ¥è¿”å›ï¼Œå¦‚æœä¸å­˜åœ¨å°±æŸ¥è¯¢æ•°æ®åº“è®©ååœ¨å°†æ•°æ®åº“ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœç¼“å­˜ç³»ç»Ÿå› ä¸ºæŸå†™åŸå› å®•æœºï¼Œé€ æˆæœåŠ¡æ— æ³•è®¿é—®ï¼Œé‚£ä¹ˆå¤§çš„é‡è¯·æ±‚ç›´æ¥ç©¿é€åˆ°æ•°æ®åº“ï¼Œæœ€æ•°æ®åº“å‹åŠ›éå¸¸å¤§ã€‚è¿™æ—¶å€™æˆ‘ä»¬è®©ehcacheä½œä¸ºäºŒçº§ç¼“å­˜ï¼Œå½“redisæœåŠ¡å™¨å®•æœºåï¼Œå¯ä»¥æŸ¥è¯¢ehcacheç¼“å­˜ã€‚<br>
è¿™æ ·èƒ½å¤Ÿæœ‰æ•ˆçš„æ‰›ä½æœåŠ¡å™¨è¯·æ±‚å‹åŠ›ã€‚</li>
</ol>
<hr>
<p>åˆ†å¸ƒå¼ç¼“å­˜å›¾<br>
<img src="https://raw.githubusercontent.com/artcodelcy/imgs/master/imgs-blog20190828144026.png" alt=""></p>
<hr>
<h2 id="spring-boot20redisehcacheå®ç°äºŒçº§ç¼“å­˜">Spring Boot2.0+Redis+Ehcacheå®ç°äºŒçº§ç¼“å­˜</h2>
<p>å‰è¨€:</p>
<ul>
<li>å…ˆèµ°æœ¬åœ°ï¼Œæœ¬åœ°æ²¡æœ‰å†èµ°ç½‘ç»œ  å°½é‡å°‘èµ°Redis  æ•ˆç‡ä¼šé«˜ä¸€äº›</li>
<li>Ehchache<br>
ä¸éœ€è¦èµ°ç½‘ç»œ,ç›´æ¥ä»å†…å­˜ä¸­è·å–.ç”±äºEhchacheå®¹å™¨é™åˆ¶ï¼Œä¼šæŒä¹…åŒ–åœ¨ç¡¬ç›˜ä¸Šã€‚</li>
</ul>
<p>å®ç°:</p>
<ul>
<li>
<p>spring bootä¸­é›†æˆäº†spring cacheï¼Œå¹¶æœ‰å¤šç§ç¼“å­˜æ–¹å¼çš„å®ç°ï¼Œå¦‚ï¼šRedisã€Caffeineã€JCacheã€EhCacheç­‰ç­‰ã€‚ä½†å¦‚æœåªç”¨ä¸€ç§ç¼“å­˜ï¼Œè¦ä¹ˆä¼šæœ‰è¾ƒå¤§çš„ç½‘ç»œæ¶ˆè€—ï¼ˆå¦‚Redisï¼‰ï¼Œè¦ä¹ˆå°±æ˜¯å†…å­˜å ç”¨å¤ªå¤§ï¼ˆå¦‚Caffeineè¿™ç§åº”ç”¨å†…å­˜ç¼“å­˜ï¼‰ã€‚åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œå¯ä»¥ç»“åˆèµ·æ¥å®ç°ä¸€ã€äºŒçº§ç¼“å­˜çš„æ–¹å¼ï¼Œèƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦æé«˜åº”ç”¨çš„å¤„ç†æ•ˆç‡ã€‚</p>
</li>
<li>
<p>spring cacheï¼šä¸»è¦åŒ…å«spring cacheå®šä¹‰çš„æ¥å£æ–¹æ³•è¯´æ˜å’Œæ³¨è§£ä¸­çš„å±æ€§è¯´æ˜</p>
</li>
</ul>
<p><strong>è¡¥å……</strong>ï¼š ç¼“å­˜ã€ä¸¤çº§ç¼“å­˜</p>
<p>ç®€å•çš„ç†è§£ï¼Œç¼“å­˜å°±æ˜¯å°†æ•°æ®ä»è¯»å–è¾ƒæ…¢çš„ä»‹è´¨ä¸Šè¯»å–å‡ºæ¥æ”¾åˆ°è¯»å–è¾ƒå¿«çš„ä»‹è´¨ä¸Šï¼Œå¦‚ç£ç›˜--&gt;å†…å­˜ã€‚å¹³æ—¶æˆ‘ä»¬ä¼šå°†æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸Šï¼Œå¦‚ï¼šæ•°æ®åº“ã€‚å¦‚æœæ¯æ¬¡éƒ½ä»æ•°æ®åº“é‡Œå»è¯»å–ï¼Œä¼šå› ä¸ºç£ç›˜æœ¬èº«çš„IOå½±å“è¯»å–é€Ÿåº¦ï¼Œæ‰€ä»¥å°±æœ‰äº†åƒredisè¿™ç§çš„å†…å­˜ç¼“å­˜ã€‚å¯ä»¥å°†æ•°æ®è¯»å–å‡ºæ¥æ”¾åˆ°å†…å­˜é‡Œï¼Œè¿™æ ·å½“éœ€è¦è·å–æ•°æ®æ—¶ï¼Œå°±èƒ½å¤Ÿç›´æ¥ä»å†…å­˜ä¸­æ‹¿åˆ°æ•°æ®è¿”å›ï¼Œèƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦çš„æé«˜é€Ÿåº¦ã€‚ä½†æ˜¯ä¸€èˆ¬redisæ˜¯å•ç‹¬éƒ¨ç½²æˆé›†ç¾¤ï¼Œæ‰€ä»¥ä¼šæœ‰ç½‘ç»œIOä¸Šçš„æ¶ˆè€—ï¼Œè™½ç„¶ä¸redisé›†ç¾¤çš„é“¾æ¥å·²ç»æœ‰è¿æ¥æ± è¿™ç§å·¥å…·ï¼Œä½†æ˜¯æ•°æ®ä¼ è¾“ä¸Šä¹Ÿè¿˜æ˜¯ä¼šæœ‰ä¸€å®šæ¶ˆè€—ã€‚æ‰€ä»¥å°±æœ‰äº†åº”ç”¨å†…ç¼“å­˜ï¼Œå¦‚ï¼šcaffeineã€‚å½“åº”ç”¨å†…ç¼“å­˜æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸ç”¨é€šè¿‡ç½‘ç»œåˆ°redisä¸­å»è·å–ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸¤çº§ç¼“å­˜ã€‚åº”ç”¨å†…ç¼“å­˜å«åšä¸€çº§ç¼“å­˜ï¼Œè¿œç¨‹ç¼“å­˜ï¼ˆå¦‚redisï¼‰å«åšäºŒçº§ç¼“å­˜<br>
<img src="https://cdn.jsdelivr.net/gh/artcodelcy/imgs/imgs-blog20190828195724.png" alt=""></p>
<p><strong>spring boot + spring cache å®ç°ä¸¤çº§ç¼“å­˜ï¼ˆredis + caffeineï¼‰ä»£ç å®ç°</strong>ï¼š</p>
<p>å®ä½“ç±»:</p>
<pre><code>@Data
public class Users implements Serializable{
  private String name;
  private Integer age;
}
</code></pre>
<p>controller:</p>
<pre><code>@RestController
public class IndexController {
    @Autowired
    private UserService userService;
    
    @RequestMapping(&quot;/userId&quot;)
    public Users getUserId(Long id){
        return userService.getUser(id);  
    }

}
</code></pre>
<p>Service:</p>
<pre><code>@Component
public class EhCacheUtils {

    // @Autowired
    // private CacheManager cacheManager;
    @Autowired
    private EhCacheCacheManager ehCacheCacheManager;

    // æ·»åŠ æœ¬åœ°ç¼“å­˜ (ç›¸åŒçš„key ä¼šç›´æ¥è¦†ç›–)
    public void put(String cacheName, String key, Object value) {
        Cache cache = ehCacheCacheManager.getCacheManager().getCache(cacheName);
        Element element = new Element(key, value);
        cache.put(element);
    }

    // è·å–æœ¬åœ°ç¼“å­˜
    public Object get(String cacheName, String key) {
        Cache cache = ehCacheCacheManager.getCacheManager().getCache(cacheName);
        Element element = cache.get(key);
        return element == null ? null : element.getObjectValue();
    }

    public void remove(String cacheName, String key) {
        Cache cache = ehCacheCacheManager.getCacheManager().getCache(cacheName);
        cache.remove(key);
    }

}
</code></pre>
<pre><code>@Component
public class RedisService {

    @Autowired
    private StringRedisTemplate stringRedisTemplate;
    //è¿™æ ·è¯¥æ–¹æ³•æ”¯æŒå¤šç§æ•°æ®ç±»å‹ 
    public void set(String key , Object object, Long time){
        //å¼€å¯äº‹åŠ¡æƒé™
        stringRedisTemplate.setEnableTransactionSupport(true);
        try {
            //å¼€å¯äº‹åŠ¡
            stringRedisTemplate.multi();
            
            String argString =(String)object;  //å¼ºè½¬ä¸‹
            stringRedisTemplate.opsForValue().set(key, argString);
            
            //æˆåŠŸå°±æäº¤
            stringRedisTemplate.exec();
        } catch (Exception e) {
            //å¤±è´¥äº†å°±å›æ»š
            stringRedisTemplate.discard();
            
        }
        if (object instanceof String ) {  //åˆ¤æ–­ä¸‹æ˜¯Stringç±»å‹ä¸
            String argString =(String)object;  //å¼ºè½¬ä¸‹
            //å­˜æ”¾Stringç±»å‹çš„
            stringRedisTemplate.opsForValue().set(key, argString);
        }
        //å¦‚æœå­˜æ”¾Setç±»å‹
        if (object instanceof Set) {
            Set&lt;String&gt; valueSet =(Set&lt;String&gt;)object;
            for(String string:valueSet){
                stringRedisTemplate.opsForSet().add(key, string);  //æ­¤å¤„ç‚¹å‡»ä¸‹æºç çœ‹ä¸‹ ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ”¾å¥½å¤š
            }
        }
        //è®¾ç½®æœ‰æ•ˆæœŸ
        if (time != null) {
            stringRedisTemplate.expire(key, time, TimeUnit.SECONDS);
        }
        
    }
    //åšä¸ªå°è£…
    public void setString(String key, Object object){
        String argString =(String)object;  //å¼ºè½¬ä¸‹
        //å­˜æ”¾Stringç±»å‹çš„
        stringRedisTemplate.opsForValue().set(key, argString);
    }
    public void setSet(String key, Object object){
        Set&lt;String&gt; valueSet =(Set&lt;String&gt;)object;
        for(String string:valueSet){
            stringRedisTemplate.opsForSet().add(key, string);  //æ­¤å¤„ç‚¹å‡»ä¸‹æºç çœ‹ä¸‹ ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ”¾å¥½å¤š
        }
    }
    
    public String getString(String key){
     return    stringRedisTemplate.opsForValue().get(key);
    }
    
    
}
</code></pre>
<pre><code>@Component
public class UserService {
    @Autowired
    private EhCacheUtils ehCacheUtils;
    @Autowired
    private RedisService redisService;
    @Autowired
    private UserMapper userMapper;
    //å®šä¹‰ä¸ªå…¨å±€çš„cacheåå­—
    private String cachename =&quot;userCache&quot;;
    
    public Users getUser(Long id){
        //å…ˆæŸ¥è¯¢ä¸€çº§ç¼“å­˜  keyä»¥å½“å‰çš„ç±»å+æ–¹æ³•å+id+å‚æ•°å€¼
        String key = this.getClass().getName() + &quot;-&quot; + Thread.currentThread().getStackTrace()[1].getMethodName()
                + &quot;-id:&quot; + id;
        //æŸ¥è¯¢ä¸€çº§ç¼“å­˜æ•°æ®æœ‰å¯¹åº”å€¼çš„å­˜åœ¨ å¦‚æœæœ‰ è¿”å›
        Users user = (Users)ehCacheUtils.get(cachename, key);
        if (user != null) {
            System.out.println(&quot;key&quot;+key+&quot;,ç›´æ¥ä»ä¸€çº§ç¼“å­˜è·å–æ•°æ®&quot;+user.toString());
            return user;
        }
        //ä¸€çº§ç¼“å­˜æ²¡æœ‰å¯¹åº”çš„å€¼å­˜åœ¨,æ¥ç€æŸ¥è¯¢äºŒçº§ç¼“å­˜    
        // rediså­˜å¯¹è±¡çš„æ–¹å¼  jsonæ ¼å¼ ç„¶åååºåˆ—å·
        String userJson = redisService.getString(key);
        //å¦‚æœrdisç¼“å­˜ä¸­æœ‰è¿™ä¸ªå¯¹åº”çš„å€¼ï¼Œä¿®æ”¹ä¸€çº§ç¼“å­˜    æœ€ä¸‹é¢çš„ä¼šæœ‰çš„ ç›¸åŒä¼šè¦†ç›–çš„    
        if (!StringUtil.isNullOrEmpty(userJson)) {  //æœ‰ è½¬æˆjson
            JSONObject jsonObject = new JSONObject();//ç”¨çš„fastjson
            Users resultUser = jsonObject.parseObject(userJson,Users.class);
            ehCacheUtils.put(cachename, key, resultUser);
            return resultUser;
        }
        //éƒ½æ²¡æœ‰ æŸ¥è¯¢DB 
        Users user1 = userMapper.getUser(id);
        if (user1 == null) {
            return null;
        }
        //å­˜æ”¾åˆ°äºŒçº§ç¼“å­˜ redisä¸­
        redisService.setString(key, new JSONObject().toJSONString(user1));
        //å­˜æ”¾åˆ°ä¸€çº§ç¼“å­˜ Ehchache
        ehCacheUtils.put(cachename, key, user1);
        return user1;
    }
}
</code></pre>
<p>å¯åŠ¨ç±»ï¼š</p>
<pre><code>@EnableCaching //å¼€å¯ç¼“å­˜
@MapperScan(basePackages={&quot;com.toov5.mapper&quot;})
@SpringBootApplication(scanBasePackages={&quot;com.toov5.*&quot;})
public class app {
   public static void main(String[] args) {
    SpringApplication.run(app.class, args);
}
    
}
</code></pre>
<p>app1.ehcache.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;ehcache xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:noNamespaceSchemaLocation=&quot;http://ehcache.org/ehcache.xsd&quot;&gt;
 
    &lt;diskStore path=&quot;java.io.tmpdir/ehcache-rmi-4000&quot; /&gt;
 
 
    &lt;!-- é»˜è®¤ç¼“å­˜ --&gt;
    &lt;defaultCache maxElementsInMemory=&quot;1000&quot; eternal=&quot;true&quot;
        timeToIdleSeconds=&quot;120&quot; timeToLiveSeconds=&quot;120&quot; overflowToDisk=&quot;true&quot;
        diskSpoolBufferSizeMB=&quot;30&quot; maxElementsOnDisk=&quot;10000000&quot;
        diskPersistent=&quot;true&quot; diskExpiryThreadIntervalSeconds=&quot;120&quot;
        memoryStoreEvictionPolicy=&quot;LRU&quot;&gt;
    &lt;/defaultCache&gt;
   
    &lt;!-- demoç¼“å­˜ --&gt;&lt;!-- name=&quot;userCache&quot; å¯¹åº”æˆ‘ä»¬åœ¨ @CacheConfig(cacheNames={&quot;userCache&quot;}) ï¼ï¼ï¼ï¼ï¼ --&gt;
    &lt;!--Ehcacheåº•å±‚ä¹Ÿæ˜¯ç”¨Mapé›†åˆå®ç°çš„ --&gt;
    &lt;cache name=&quot;userCache&quot; maxElementsInMemory=&quot;1000&quot; eternal=&quot;false&quot;
        timeToIdleSeconds=&quot;120&quot; timeToLiveSeconds=&quot;120&quot; overflowToDisk=&quot;true&quot;
        diskSpoolBufferSizeMB=&quot;30&quot; maxElementsOnDisk=&quot;10000000&quot;
        diskPersistent=&quot;false&quot; diskExpiryThreadIntervalSeconds=&quot;120&quot;
        memoryStoreEvictionPolicy=&quot;LRU&quot;&gt;  &lt;!-- LRUç¼“å­˜ç­–ç•¥ --&gt;
        &lt;cacheEventListenerFactory
            class=&quot;net.sf.ehcache.distribution.RMICacheReplicatorFactory&quot; /&gt;
        &lt;!-- ç”¨äºåœ¨åˆå§‹åŒ–ç¼“å­˜ï¼Œä»¥åŠè‡ªåŠ¨è®¾ç½® --&gt;
        &lt;bootstrapCacheLoaderFactory
            class=&quot;net.sf.ehcache.distribution.RMIBootstrapCacheLoaderFactory&quot; /&gt;
    &lt;/cache&gt;
&lt;/ehcache&gt;
</code></pre>
<p>yml</p>
<pre><code>###ç«¯å£å·é…ç½®
server:
  port: 8080
###æ•°æ®åº“é…ç½® 
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/test
    username: root
    password: root
    driver-class-name: com.mysql.jdbc.Driver
    test-while-idle: true
    test-on-borrow: true
    validation-query: SELECT 1 FROM DUAL
    time-between-eviction-runs-millis: 300000
    min-evictable-idle-time-millis: 1800000
# ç¼“å­˜é…ç½®è¯»å–
  cache:
    type: ehcache
    ehcache:
      config: classpath:app1_ehcache.xml
 
  redis:
    database: 0  
    host:  192.168.91.3
    port:  6379
    password:  123
    jedis:
      pool:
        max-active: 8
        max-wait: -1
        max-idle: 8
        min-idle: 0
    timeout: 10000
</code></pre>
<p>è¿è¡Œç»“æœ<br>
<img src="https://cdn.jsdelivr.net/gh/artcodelcy/imgs/imgs-blog20190828200300.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/artcodelcy/imgs/imgs-blog20190828200355.png" alt=""></p>
<p>åé¢çš„è®¿é—®ï¼Œåœ¨æ§åˆ¶å°æ‰“å°ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/artcodelcy/imgs/imgs-blog20190828200424.png" alt=""></p>
<p>ä»£ç ä¸€å®šè¦æ³¨æ„:</p>
<ul>
<li>ä¸€çº§ç¼“å­˜è¿‡æœŸæ—¶é—´, æ¯”äºŒçº§è¦çŸ­ä¸€äº›ã€‚</li>
<li>è¿™é‡Œçš„ä¸¤çº§ç¼“å­˜æ—¶é—´é—®é¢˜ï¼Œæ‰§è¡Œè®¾ç½®äºŒçº§ç¼“å­˜æ—¶å€™éœ€è¦æ—¶é—´çš„ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ—¶é—´è®¾ç½®é—®é¢˜ä¸€å®šè¦æ³¨æ„äº†ã€‚å¦‚ä¸‹å›¾ï¼š<br>
<img src="https://cdn.jsdelivr.net/gh/artcodelcy/imgs/imgs-blog20190828200618.png" alt=""></li>
</ul>
<p><strong>åˆ†å¸ƒå¼ç¼“å­˜çš„æ€è€ƒ:</strong></p>
<ul>
<li>åº”ç”¨ç¼“å­˜ï¼š ç¼“å­˜å‘½ä¸­ç‡ã€ç¼“å­˜å›æ”¶ç­–ç•¥ Javaç¼“å­˜ç±»å‹ã€ç£ç›˜ç¼“å­˜</li>
<li>Httpç¼“å­˜ï¼š  Httpå®¢æˆ·ç«¯ç¼“å­˜ã€   NginxHttpç¼“å­˜è®¾ç½®ã€Nginxä»£ç†ç¼“å­˜</li>
<li>å¤šçº§ç¼“å­˜ï¼š ç¼“å­˜æ•°æ®ã€   åˆ†å¸ƒå¼ç¼“å­˜ä¸è´Ÿè½½å‡è¡¡ã€çƒ­ç‚¹æ•°æ®ä¸æ›´æ–°ç¼“å­˜ã€ç¼“å­˜å´©æºƒä¸å¿«é€Ÿä¿®å¤</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Rediså®‰è£…]]></title>
        <id>https://artcodelcy.github.io//post/redis-an-zhuang</id>
        <link href="https://artcodelcy.github.io//post/redis-an-zhuang">
        </link>
        <updated>2019-08-28T13:38:40.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å‰æ">å‰æ</h2>
<p>é¦–å…ˆè¦æœ‰wget å’Œ gcc</p>
<ul>
<li>yum -y install wget</li>
<li>gcc yum install gcc</li>
</ul>
<ol>
<li>ä¸‹è½½Rediså®‰è£…åŒ…</li>
</ol>
<ul>
<li>wget http://download.redis.io/releases/redis-3.2.9.tar.gz</li>
</ul>
<ol start="2">
<li>è§£å‹Rediså®‰è£…åŒ…</li>
</ol>
<ul>
<li>tar -zxvf redis-3.2.9.tar.gz</li>
</ul>
<ol start="3">
<li>å®‰è£…</li>
</ol>
<ul>
<li>cd redis-3.2.9</li>
<li>make</li>
<li>cd src</li>
<li>mkdir /usr/local/redis</li>
<li>make install PREFIX=/usr/local/redis</li>
</ul>
<ol start="4">
<li>ç§»åŠ¨é…ç½®æ–‡ä»¶åˆ°å®‰è£…ç›®å½•ä¸‹</li>
</ol>
<ul>
<li>cd ../</li>
<li>mkdir /usr/local/redis/etc</li>
<li>mv redis.conf /usr/local/redis/etc</li>
</ul>
<ol start="5">
<li>é…ç½®redisä¸ºåå°å¯åŠ¨</li>
</ol>
<ul>
<li>vi /usr/local/redis/etc/redis.conf           //å°†daemonize no æ”¹æˆdaemonize yes</li>
<li>vi /usr/local/redis/etc/redis.conf           // requirepass 123 ï¼ˆæ³¨æ„å»æ‰å‰é¢çš„ â€œâ€#â€å·ï¼‰</li>
<li>#bind 127.0.0.1                          å¼€å¯å¤–ç½‘è®¿é—®</li>
</ul>
<ol start="6">
<li>å¼€å¯redis</li>
</ol>
<ul>
<li>/usr/local/redis/bin/redis-server</li>
<li>/usr/local/redis/etc/redis.conf</li>
</ul>
<ol start="7">
<li>è¿æ¥Rediså®¢æˆ·ç«¯</li>
</ol>
<ul>
<li>/usr/local/redis/bin/redis-cli -h 127.0.0.1 -p 6379 -a &quot;123&quot;</li>
</ul>
<p>PING ç»“æœè¡¨ç¤ºæˆåŠŸï¼š</p>
<p><img src="https://raw.githubusercontent.com/artcodelcy/imgs/master/imgs-blog20190828172714.png" alt=""></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Redisä»‹ç»]]></title>
        <id>https://artcodelcy.github.io//post/redis-jie-shao</id>
        <link href="https://artcodelcy.github.io//post/redis-jie-shao">
        </link>
        <updated>2019-08-27T16:01:22.000Z</updated>
        <content type="html"><![CDATA[<h3 id="æ¦‚å¿µ">æ¦‚å¿µ</h3>
<ul>
<li>
<p>ä»€ä¹ˆæ˜¯Redis<br>
Redisæ˜¯ç”±æ„å¤§åˆ©äººSalvatore Sanfilippoï¼ˆç½‘åï¼šantirezï¼‰å¼€å‘çš„ä¸€æ¬¾å†…å­˜é«˜é€Ÿç¼“å­˜æ•°æ®åº“ã€‚Rediså…¨ç§°ä¸ºï¼šRemote Dictionary Serverï¼ˆè¿œç¨‹æ•°æ®æœåŠ¡ï¼‰ï¼Œè¯¥è½¯ä»¶ä½¿ç”¨Cè¯­è¨€ç¼–å†™ï¼ŒRedisæ˜¯ä¸€ä¸ªkey-valueå­˜å‚¨ç³»ç»Ÿï¼Œå®ƒæ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œå¦‚ï¼šstringã€listã€setã€zset(sorted set)ã€hashã€‚<br>
Redisé‡‡ç”¨çš„æ˜¯åŸºäºå†…å­˜çš„é‡‡ç”¨çš„æ˜¯å•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å‹çš„KVæ•°æ®åº“ï¼Œç”±Cè¯­è¨€ç¼–å†™ã€‚å®˜æ–¹æä¾›çš„æ•°æ®æ˜¯å¯ä»¥è¾¾åˆ°100000+çš„qps</p>
</li>
<li>
<p>Rediså•çº¿ç¨‹å¥½å¤„ï¼š<br>
ä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—<br>
ä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€—CPU<br>
æ‰€ä»¥redisçº¿ç¨‹æ˜¯å®‰å…¨çš„</p>
</li>
<li>
<p>Rediså•è¿›ç¨‹å•çº¿ç¨‹å¼Šç«¯ï¼š<br>
æ— æ³•å‘æŒ¥å¤šæ ¸CPUæ€§èƒ½ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡åœ¨å•æœºå¼€å¤šä¸ªRediså®ä¾‹æ¥å®Œå–„ï¼›</p>
</li>
</ul>
<h3 id="é«˜çº§ç‰¹æ€§">é«˜çº§ç‰¹æ€§</h3>
<ol>
<li>æŒä¹…åŒ–æœºåˆ¶</li>
<li>å“¨å…µæœºåˆ¶é«˜å¯ç”¨</li>
<li>å¤šç§é›†ç¾¤æ–¹æ¡ˆ</li>
</ol>
<p>Redisåº”ç”¨åœºæ™¯</p>
<ol>
<li>
<p>ã€ä»¤ç‰Œ(Token)ç”Ÿæˆã€‘</p>
</li>
<li>
<p>ã€çŸ­ä¿¡éªŒè¯ç ã€‘</p>
</li>
<li>
<p>ã€å‘å¸ƒè®¢é˜…ã€‘ï¼Œç›¸å½“äºæ¶ˆæ¯ç³»ç»Ÿï¼ŒActiveMQï¼ŒRocketMQç­‰å·¥å…·ç±»ä¼¼ï¼Œä½†æ˜¯ä¸ªäººè§‰å¾—ç®€å•ç”¨ä¸€ä¸‹è¿˜è¡Œï¼Œå¦‚æœå¯¹äºæ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„è¯è¿˜æ˜¯ç”¨RocketMQç­‰ä¸“ä¸šç³»ç»Ÿã€‚ç”±äºredisæŠŠæ•°æ®æ·»åŠ åˆ°é˜Ÿåˆ—æ˜¯è¿”å›æ·»åŠ å…ƒç´ åœ¨é˜Ÿåˆ—çš„ç¬¬å‡ ä½ï¼Œæ‰€ä»¥å¯ä»¥åšåˆ¤æ–­ç”¨æˆ·æ˜¯ç¬¬å‡ ä¸ªè®¿é—®è¿™ç§ä¸šåŠ¡<br>
é˜Ÿåˆ—ä¸ä»…å¯ä»¥æŠŠå¹¶å‘è¯·æ±‚å˜æˆä¸²è¡Œï¼Œå¹¶ä¸”è¿˜å¯ä»¥åšé˜Ÿåˆ—æˆ–è€…æ ˆä½¿ç”¨</p>
</li>
<li>
<p>ã€åˆ†å¸ƒå¼é”ã€‘</p>
</li>
<li>
<p>ã€éªŒè¯å‰ç«¯çš„é‡å¤è¯·æ±‚ã€‘ï¼ˆå¯ä»¥è‡ªç”±æ‰©å±•ç±»ä¼¼æƒ…å†µï¼‰ï¼Œå¯ä»¥é€šè¿‡redisè¿›è¡Œè¿‡æ»¤ï¼šæ¯æ¬¡è¯·æ±‚å°†request Ipã€å‚æ•°ã€æ¥å£ç­‰hashä½œä¸ºkeyå­˜å‚¨redisï¼ˆå¹‚ç­‰æ€§è¯·æ±‚ï¼‰ï¼Œè®¾ç½®å¤šé•¿æ—¶é—´æœ‰æ•ˆæœŸï¼Œç„¶åä¸‹æ¬¡è¯·æ±‚è¿‡æ¥çš„æ—¶å€™å…ˆåœ¨redisä¸­æ£€ç´¢æœ‰æ²¡æœ‰è¿™ä¸ªkeyï¼Œè¿›è€ŒéªŒè¯æ˜¯ä¸æ˜¯ä¸€å®šæ—¶é—´å†…è¿‡æ¥çš„é‡å¤æäº¤</p>
</li>
<li>
<p>ã€ç§’æ€ç³»ç»Ÿã€‘ï¼ŒåŸºäºredisæ˜¯å•çº¿ç¨‹ç‰¹å¾ï¼Œé˜²æ­¢å‡ºç°æ•°æ®åº“â€œçˆ†ç ´â€</p>
</li>
<li>
<p>ã€å…¨å±€å¢é‡IDç”Ÿæˆã€‘ï¼Œç±»ä¼¼â€œç§’æ€â€</p>
</li>
<li>
<p>ã€è®¡æ•°å™¨ã€‘<br>
è¯¸å¦‚ç»Ÿè®¡ç‚¹å‡»æ•°ç­‰åº”ç”¨ã€‚ç”±äºå•çº¿ç¨‹ï¼Œå¯ä»¥é¿å…å¹¶å‘é—®é¢˜ï¼Œä¿è¯ä¸ä¼šå‡ºé”™ï¼Œè€Œä¸”100%æ¯«ç§’çº§æ€§èƒ½ï¼</p>
</li>
<li>
<p>ã€ç¼“å­˜(çƒ­ç‚¹æ•°æ®)ã€‘<br>
çƒ­ç‚¹æ•°æ®ï¼ˆç»å¸¸ä¼šè¢«æŸ¥è¯¢ï¼Œä½†æ˜¯ä¸ç»å¸¸è¢«ä¿®æ”¹æˆ–è€…åˆ é™¤çš„æ•°æ®ï¼‰ï¼Œé¦–é€‰æ˜¯ä½¿ç”¨redisç¼“å­˜ï¼Œæ¯•ç«Ÿå¼ºå¤§åˆ°å†’æ³¡çš„QPSå’Œæå¼ºçš„ç¨³å®šæ€§ä¸æ˜¯æ‰€æœ‰ç±»ä¼¼å·¥å…·éƒ½æœ‰çš„ï¼Œè€Œä¸”ç›¸æ¯”äºmemcachedè¿˜æä¾›äº†ä¸°å¯Œçš„æ•°æ®ç±»å‹å¯ä»¥ä½¿ç”¨ï¼Œå¦å¤–ï¼Œå†…å­˜ä¸­çš„æ•°æ®ä¹Ÿæä¾›äº†AOFå’ŒRDBç­‰æŒä¹…åŒ–æœºåˆ¶å¯ä»¥é€‰æ‹©ï¼Œè¦å†·ã€çƒ­çš„è¿˜æ˜¯å¿½å†·å¿½çƒ­çš„éƒ½å¯é€‰ã€‚</p>
</li>
</ol>
<p>ç»“åˆå…·ä½“åº”ç”¨éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼šå¾ˆå¤šäººç”¨springçš„AOPæ¥æ„å»ºredisç¼“å­˜çš„è‡ªåŠ¨ç”Ÿäº§å’Œæ¸…é™¤ï¼Œè¿‡ç¨‹å¯èƒ½å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>Select æ•°æ®åº“å‰æŸ¥è¯¢redisï¼Œæœ‰çš„è¯ä½¿ç”¨redisæ•°æ®ï¼Œæ”¾å¼ƒselect æ•°æ®åº“ï¼Œæ²¡æœ‰çš„è¯ï¼Œselect æ•°æ®åº“ï¼Œç„¶åå°†æ•°æ®æ’å…¥redis</p>
</li>
<li>
<p>updateæˆ–è€…deleteæ•°æ®åº“é’±ï¼ŒæŸ¥è¯¢redisæ˜¯å¦å­˜åœ¨è¯¥æ•°æ®ï¼Œå­˜åœ¨çš„è¯å…ˆåˆ é™¤redisä¸­æ•°æ®ï¼Œç„¶åå†updateæˆ–è€…deleteæ•°æ®åº“ä¸­çš„æ•°æ®</p>
</li>
</ul>
<p>ä¸Šé¢è¿™ç§æ“ä½œï¼Œå¦‚æœå¹¶å‘é‡å¾ˆå°çš„æƒ…å†µä¸‹åŸºæœ¬æ²¡é—®é¢˜ï¼Œä½†æ˜¯é«˜å¹¶å‘çš„æƒ…å†µè¯·æ³¨æ„ä¸‹é¢åœºæ™¯ï¼š</p>
<p>ä¸ºäº†updateå…ˆåˆ æ‰äº†redisä¸­çš„è¯¥æ•°æ®ï¼Œè¿™æ—¶å€™å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒæŸ¥è¯¢ï¼Œå‘ç°redisä¸­æ²¡æœ‰ï¼Œç¬é—´æ‰§è¡Œäº†æŸ¥è¯¢SQLï¼Œå¹¶ä¸”æ’å…¥åˆ°redisä¸­ä¸€æ¡æ•°æ®ï¼Œå›åˆ°åˆšæ‰é‚£ä¸ªupdateè¯­å¥ï¼Œè¿™ä¸ªæ‚²å‚¬çš„çº¿ç¨‹å‹æ ¹ä¸çŸ¥é“åˆšæ‰é‚£ä¸ªè¯¥æ­»çš„selectçº¿ç¨‹çŠ¯äº†ä¸€ä¸ªå¼¥å¤©å¤§é”™ï¼äºæ˜¯è¿™ä¸ªredisä¸­çš„é”™è¯¯æ•°æ®å°±æ°¸è¿œçš„å­˜åœ¨äº†ä¸‹å»ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªupdateæˆ–è€…deleteã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä¼Ÿå¤§æ˜¯ç†¬å‡ºæ¥çš„]]></title>
        <id>https://artcodelcy.github.io//post/wei-da-shi-ao-chu-lai-de</id>
        <link href="https://artcodelcy.github.io//post/wei-da-shi-ao-chu-lai-de">
        </link>
        <updated>2019-08-26T16:08:44.000Z</updated>
        <content type="html"><![CDATA[<p>ç»§ç»­ç†¬ç€ï¼Œç†¬ç€....</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://artcodelcy.github.io//post/hello-gridea</id>
        <link href="https://artcodelcy.github.io//post/hello-gridea">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="http://hvenotes.fehey.com/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>ğ–¶ğ—‚ğ—‡ğ–½ğ—ˆğ—ğ—Œ</strong> æˆ– <strong>ğ–¬ğ–ºğ–¼ğ–®ğ–²</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>